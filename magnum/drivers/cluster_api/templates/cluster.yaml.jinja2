---
apiVersion: azimuth.stackhpc.com/v1alpha1
kind: Cluster
metadata:
  name: "{{ cluster.uuid }}"
spec:
  addons:
    apps: true
    certManager: false
    dashboard: true
    ingress: false
    monitoring: true
  autohealing: true
  cloudCredentialsSecretName: "project-{{ cluster.project_id }}"
  controlPlaneMachineSize: "{{ cluster.master_flavor_id | urlencode }}"
  label: "{{ cluster.uuid }}"
  machineRootVolumeSize: 0
  nodeGroups:
  - autoscale: false
    count: {{ cluster.node_count }}
    machineSize: "{{ cluster.flavor_id | urlencode }}"
    name: "default"
  {%- for ng in cluster.nodegroups %}{% if not ng.is_default %}
  - autoscale: false
    count: {{ ng.node_count }}
    machineSize: "{{ ng.flavor_id | urlencode }}"
    name: "{{ ng.uuid }}"{% endif %}{% endfor %}
  templateName: "{{ cluster.cluster_template.uuid }}"
